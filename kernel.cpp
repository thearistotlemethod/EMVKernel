#include <iostream>
#include "entrypoint.h"

void RunTest();

int main(int argc, char **argv)
{
    std::cout << "Kernel " << emvl2Version() << "\n";
	RunTest();
}

void RunTest() {
	emvl2Init("Gemplus USB Smart Card Reader 0", NULL, NULL);

	emvl2AddCaKey("A000000003", 0x94, "ACD2B12302EE644F3F835ABD1FC7A6F62CCE48FFEC622AA8EF062BEF6FB8BA8BC68BBF6AB5870EED579BC3973E121303D34841A796D6DCBC41DBF9E52C4609795C0CCF7EE86FA1D5CB041071ED2C51D2202F63F1156C58A92D38BC60BDF424E1776E2BC9648078A03B36FB554375FC53D57C73F5160EA59F3AFC5398EC7B67758D65C9BFF7828B6B82D4BE124A416AB7301914311EA462C19F771F31B3B57336000DFF732D3B83DE07052D730354D297BEC72871DCCF0E193F171ABA27EE464C6A97690943D59BDABB2A27EB71CEEBDAFA1176046478FD62FEC452D5CA393296530AA3F41927ADFE434A2DF2AE3054F8840657A26E0FC617",
		"03");
	emvl2AddCaKey("A000000004", 0xEF, "A191CB87473F29349B5D60A88B3EAEE0973AA6F1A082F358D849FDDFF9C091F899EDA9792CAF09EF28F5D22404B88A2293EEBBC1949C43BEA4D60CFD879A1539544E09E0F09F60F065B2BF2A13ECC705F3D468B9D33AE77AD9D3F19CA40F23DCF5EB7C04DC8F69EBA565B1EBCB4686CD274785530FF6F6E9EE43AA43FDB02CE00DAEC15C7B8FD6A9B394BABA419D3F6DC85E16569BE8E76989688EFEA2DF22FF7D35C043338DEAA982A02B866DE5328519EBBCD6F03CDD686673847F84DB651AB86C28CF1462562C577B853564A290C8556D818531268D25CC98A4CC6A0BDFFFDA2DCCA3A94C998559E307FDDF915006D9A987B07DDAEB3B",
		"03");

	emvl2AddAidPrms("00", "9F3501229F3303E0F0C89F4005FF00F0A0019F1A0207925F2A020949DF8B110400000000DF8B120B9F37049F47018F019F3201DF8B13039F0802DF8B140100DF8B150100DF812005F850ACA000DF8121050000000000DF812205F850ACF8009F090200029F1B0400000000");
	emvl2AddAidPrms("A0000003330101", "9F09020020");
	emvl2AddAidPrms("A0000000031010", "9F090200969F1B0400003A98");
	emvl2AddAidPrms("A0000000032010", "9F0902008C9F1B04000000FA");
	emvl2AddAidPrms("A0000000033010", "9F0902008C9F1B0400000000");
	emvl2AddAidPrms("A0000000038010", "9F0902008C9F1B0400000000");
	emvl2AddAidPrms("A0000000041010", "");
	emvl2AddAidPrms("A0000000043060", "");
	emvl2AddAidPrms("A0000000046000", "");
	emvl2AddAidPrms("A0000000046010", "");
	emvl2AddAidPrms("A0000000042203", "");
	emvl2AddAidPrms("A00000002501", "9F090200019F1B0400003A98");
	emvl2AddAidPrms("A0000003241010", "");
	emvl2AddAidPrms("A0000001523010", "9F1B0400003A98");
	emvl2AddAidPrms("A0000001524010", "");
	emvl2AddAidPrms("A0000000651010", "9F090202009F1B04000007D0");
	emvl2AddAidPrms("A0000006151010", "");
	emvl2AddAidPrms("A0000005241010", "");
	emvl2AddAidPrms("A0000002771010", "9F090200019F1A0201245F2A020124");

	emvl2Start(0, 0, "100", "0");

	uint8_t buffer[64];
	int len = emvl2GetTag(0x95, buffer, sizeof(buffer));
	if (len > 0) {
		printf("%02X%02X%02X%02X%02X\n", buffer[0], buffer[1], buffer[2], buffer[3], buffer[4]);
	}
}
